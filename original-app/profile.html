<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mon Profil - LinkedOut</title>
    <link rel="stylesheet" href="styles/main.css">
    <link rel="stylesheet" href="styles/components.css">
    <link rel="stylesheet" href="styles/responsive.css">
</head>
<body class="app-layout">
    <header class="app-header">
        <div class="container">
            <nav class="app-nav">
                <a href="dashboard.html" class="app-logo">LinkedOut</a>
                
                <!-- LinkedIn-style search bar -->
                <div class="search-container">
                    <input type="text" class="search-input" placeholder="Rechercher des ch√¥meurs professionnels...">
                    <button class="search-button">üîç</button>
                </div>
                
                <ul class="nav-menu">
                    <li><a href="dashboard.html" class="nav-link">Accueil</a></li>
                    <li><a href="profile.html" class="nav-link active">Mon Profil</a></li>
                    <li><a href="network.html" class="nav-link">R√©seau</a></li>
                    <li><a href="jobs.html" class="nav-link">Emplois Bidons</a></li>
                </ul>
                
                <div class="user-menu">
                    <div class="notification-icon">üîî</div>
                    <div class="user-avatar" id="user-avatar">JG</div>
                    <button class="btn btn-secondary btn-sm" onclick="window.LinkedOutAuth.logout()">D√©connexion</button>
                </div>
            </nav>
        </div>
    </header>

    <main class="main-content">
        <!-- Left Sidebar -->
        <aside class="sidebar-left">
            <!-- Quick Actions -->
            <div class="card">
                <div class="card-header">
                    <h3 class="card-title">Actions Rapides</h3>
                </div>
                <div class="quick-actions">
                    <button class="btn btn-primary" onclick="editProfile()">Modifier le profil</button>
                    <button class="btn btn-secondary" onclick="addSkill()">Ajouter une comp√©tence</button>
                    <button class="btn btn-secondary" onclick="addFailure()">Ajouter un √©chec</button>
                </div>
            </div>

            <!-- Profile Stats -->
            <div class="card">
                <div class="card-header">
                    <h3 class="card-title">Statistiques</h3>
                </div>
                <div class="profile-stats" id="profile-stats">
                    <!-- Stats will be loaded here -->
                </div>
            </div>

            <!-- Recent Activity -->
            <div class="card">
                <div class="card-header">
                    <h3 class="card-title">Activit√© R√©cente</h3>
                </div>
                <div class="recent-activity" id="recent-activity">
                    <!-- Activity will be loaded here -->
                </div>
            </div>
        </aside>

        <!-- Main Profile Content -->
        <section class="main-profile">
            <!-- Profile Header -->
            <div class="card profile-card">
                <div class="profile-header" id="profile-header">
                    <div class="profile-avatar-large" id="profile-avatar">JG</div>
                    <h1 class="profile-name" id="profile-name">Jean Glandeur</h1>
                    <p class="profile-title" id="profile-title">Expert en procrastination avanc√©e</p>
                    <div class="unemployment-counter">
                        <span class="counter-number" id="unemployment-days">412</span>
                        <span class="counter-label">jours sans emploi</span>
                    </div>
                </div>
                
                <div class="profile-content">
                    <!-- Bio Section -->
                    <div class="profile-section">
                        <h3>√Ä propos</h3>
                        <p id="profile-bio">Passionn√© de l'art de ne rien faire avec style. Sp√©cialiste reconnu en optimisation du temps libre et en maximisation du confort domestique.</p>
                        <button class="btn btn-secondary btn-sm" onclick="editBio()">Modifier</button>
                    </div>

                    <!-- Experience Section -->
                    <div class="profile-section">
                        <h3>Exp√©rience en Ch√¥mage</h3>
                        <div class="experience-item">
                            <div class="experience-header">
                                <h4>Expert en Procrastination Avanc√©e</h4>
                                <span class="experience-duration" id="unemployment-duration">Depuis janvier 2023</span>
                            </div>
                            <p class="experience-company">Ind√©pendant</p>
                            <p class="experience-description">
                                D√©veloppement et perfectionnement de techniques avanc√©es de procrastination. 
                                Expertise en √©vitement de responsabilit√©s et optimisation du temps libre.
                            </p>
                        </div>
                    </div>

                    <!-- Skills Section -->
                    <div class="profile-section">
                        <h3>Comp√©tences Inutiles</h3>
                        <div class="skills-container" id="skills-container">
                            <!-- Skills will be loaded here -->
                        </div>
                    </div>

                    <!-- Failures Section -->
                    <div class="profile-section">
                        <h3>√âchecs Professionnels M√©morables</h3>
                        <div class="failures-list" id="failures-list">
                            <!-- Failures will be loaded here -->
                        </div>
                        <button class="btn btn-secondary" onclick="addFailure()">Ajouter un √©chec</button>
                    </div>
                </div>
            </div>

            <!-- Recent Posts -->
            <div class="card">
                <div class="card-header">
                    <h3 class="card-title">Mes Posts R√©cents</h3>
                </div>
                <div class="user-posts" id="user-posts">
                    <!-- User posts will be loaded here -->
                </div>
            </div>
        </section>

        <!-- Right Sidebar -->
        <aside class="sidebar-right">
            <!-- Badges Section -->
            <div class="card">
                <div class="card-header">
                    <h3 class="card-title">Mes Badges</h3>
                    <a href="#" class="view-all-link" onclick="showAllBadges()">Voir tout</a>
                </div>
                <div class="user-badges" id="user-badges">
                    <!-- Badges will be loaded here -->
                </div>
            </div>

            <!-- Connections Preview -->
            <div class="card">
                <div class="card-header">
                    <h3 class="card-title">Mes Connexions</h3>
                    <a href="network.html" class="view-all-link">Voir tout</a>
                </div>
                <div class="connections-preview" id="connections-preview">
                    <!-- Connections will be loaded here -->
                </div>
            </div>

            <!-- Profile Completeness -->
            <div class="card">
                <div class="card-header">
                    <h3 class="card-title">Compl√©tude du Profil</h3>
                </div>
                <div class="profile-completeness">
                    <div class="progress-circle" id="profile-progress">
                        <div class="progress-fill"></div>
                        <span class="progress-text">85%</span>
                    </div>
                    <div class="completeness-tips">
                        <p>‚úÖ Photo de profil ajout√©e</p>
                        <p>‚úÖ Bio remplie</p>
                        <p>‚úÖ Comp√©tences ajout√©es</p>
                        <p>‚ùå Ajouter plus d'√©checs</p>
                        <p>‚ùå Publier plus de posts</p>
                    </div>
                </div>
            </div>
        </aside>
    </main>

    <!-- Edit Profile Modal -->
    <div id="edit-profile-modal" class="modal hidden">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Modifier le Profil</h3>
                <button class="modal-close" onclick="closeModal('edit-profile-modal')">&times;</button>
            </div>
            <div class="modal-body">
                <form id="edit-profile-form">
                    <div class="form-group">
                        <label for="edit-name">Nom</label>
                        <input type="text" id="edit-name" name="name" required>
                    </div>
                    <div class="form-group">
                        <label for="edit-title">Titre</label>
                        <input type="text" id="edit-title" name="title" required>
                    </div>
                    <div class="form-group">
                        <label for="edit-bio">Bio</label>
                        <textarea id="edit-bio" name="bio" rows="4"></textarea>
                    </div>
                    <div class="form-group">
                        <label for="edit-unemployment-start">D√©but du ch√¥mage</label>
                        <input type="date" id="edit-unemployment-start" name="unemploymentStart" required>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeModal('edit-profile-modal')">Annuler</button>
                <button class="btn btn-primary" onclick="saveProfile()">Sauvegarder</button>
            </div>
        </div>
    </div>

    <!-- Add Skill Modal -->
    <div id="add-skill-modal" class="modal hidden">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Ajouter une Comp√©tence</h3>
                <button class="modal-close" onclick="closeModal('add-skill-modal')">&times;</button>
            </div>
            <div class="modal-body">
                <form id="add-skill-form">
                    <div class="form-group">
                        <label for="skill-name">Nom de la comp√©tence</label>
                        <input type="text" id="skill-name" name="skillName" placeholder="Ex: Ma√Ætre du scroll infini" required>
                    </div>
                    <div class="skill-suggestions">
                        <p>Suggestions:</p>
                        <div class="suggestion-tags">
                            <span class="suggestion-tag" onclick="insertSkillSuggestion('Expert en Netflix')">Expert en Netflix</span>
                            <span class="suggestion-tag" onclick="insertSkillSuggestion('Champion de sieste')">Champion de sieste</span>
                            <span class="suggestion-tag" onclick="insertSkillSuggestion('Ma√Ætre de la procrastination')">Ma√Ætre de la procrastination</span>
                            <span class="suggestion-tag" onclick="insertSkillSuggestion('Sp√©cialiste en √©vitement')">Sp√©cialiste en √©vitement</span>
                        </div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeModal('add-skill-modal')">Annuler</button>
                <button class="btn btn-primary" onclick="saveSkill()">Ajouter</button>
            </div>
        </div>
    </div>

    <!-- Add Failure Modal -->
    <div id="add-failure-modal" class="modal hidden">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Ajouter un √âchec M√©morable</h3>
                <button class="modal-close" onclick="closeModal('add-failure-modal')">&times;</button>
            </div>
            <div class="modal-body">
                <form id="add-failure-form">
                    <div class="form-group">
                        <label for="failure-description">Description de l'√©chec</label>
                        <textarea id="failure-description" name="failureDescription" rows="3" placeholder="Racontez votre √©chec avec fiert√©..." required></textarea>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeModal('add-failure-modal')">Annuler</button>
                <button class="btn btn-primary" onclick="saveFailure()">Ajouter √† ma collection</button>
            </div>
        </div>
    </div>

    <script src="js/utils.js"></script>
    <script src="js/data.js"></script>
    <script src="js/auth.js"></script>
    <script src="js/feed.js"></script>
    <script src="js/endorsements.js"></script>
    <script src="js/badges.js"></script>
    <script src="js/profile.js"></script>
    <script>
        // Initialize profile page
        document.addEventListener('DOMContentLoaded', function() {
            // Check authentication
            if (!window.LinkedOutAuth.requireAuth()) {
                return;
            }

            // Initialize data
            window.LinkedOutData.init();
            
            // Initialize profile components
            initializeProfile();
        });

        function initializeProfile() {
            const currentUser = window.LinkedOutAuth.getCurrentUser();
            
            // Initialize profile manager
            window.LinkedOutProfile.init(currentUser.id);
            
            // Load all profile sections
            loadProfileData(currentUser);
        }

        function loadProfileData(user) {
            // Update header info
            updateProfileHeader(user);
            
            // Load skills
            window.LinkedOutEndorsements.init();
            loadSkills(user);
            
            // Load badges
            window.LinkedOutBadges.init();
            loadBadges(user);
            
            // Load failures
            loadFailures(user);
            
            // Load connections preview
            loadConnectionsPreview(user);
            
            // Load recent posts
            loadRecentPosts(user);
            
            // Load stats
            loadProfileStats(user);
            
            // Load recent activity
            loadRecentActivity(user);
        }

        function updateProfileHeader(user) {
            // Update avatar
            const avatar = document.getElementById('profile-avatar');
            const userAvatar = document.getElementById('user-avatar');
            const initials = window.LinkedOutUtils.StringUtils.getInitials(user.name);
            avatar.textContent = initials;
            userAvatar.textContent = initials;
            
            // Update basic info
            document.getElementById('profile-name').textContent = user.name;
            document.getElementById('profile-title').textContent = user.title;
            document.getElementById('profile-bio').textContent = user.bio || 'Aucune bio ajout√©e';
            
            // Calculate unemployment days
            const unemploymentDays = window.LinkedOutUtils.DateUtils.daysSince(user.unemploymentStart);
            document.getElementById('unemployment-days').textContent = unemploymentDays;
            
            // Update unemployment duration
            const startDate = window.LinkedOutUtils.DateUtils.formatDate(user.unemploymentStart);
            document.getElementById('unemployment-duration').textContent = `Depuis ${startDate}`;
        }

        function loadSkills(user) {
            const container = document.getElementById('skills-container');
            container.innerHTML = user.skills.map(skill => `
                <div class="skill-item">
                    <div class="skill-info">
                        <span class="skill-name">${skill.name}</span>
                        <span class="skill-endorsements">${skill.endorsements || 0} endorsements</span>
                    </div>
                    <button class="btn btn-secondary btn-sm" onclick="removeSkill('${skill.name}')">Supprimer</button>
                </div>
            `).join('');
        }

        function loadBadges(user) {
            const container = document.getElementById('user-badges');
            const userBadges = window.LinkedOutBadges.getUserBadges(user.id);
            const earnedBadges = userBadges.filter(badge => badge.earned).slice(0, 6);
            
            container.innerHTML = earnedBadges.map(badge => `
                <div class="badge-item earned">
                    <span class="badge-icon">${badge.icon}</span>
                    <div class="badge-info">
                        <div class="badge-name">${badge.title}</div>
                        <div class="badge-date">${window.LinkedOutUtils.DateUtils.formatDate(badge.earnedDate)}</div>
                    </div>
                </div>
            `).join('');
            
            if (earnedBadges.length === 0) {
                container.innerHTML = '<p class="no-badges">Aucun badge encore. Continuez √† glander pour en obtenir !</p>';
            }
        }

        function loadFailures(user) {
            const container = document.getElementById('failures-list');
            container.innerHTML = (user.failures || []).map((failure, index) => `
                <div class="failure-item">
                    <span class="failure-icon">ü§¶‚Äç‚ôÇÔ∏è</span>
                    <span class="failure-text">${failure}</span>
                    <button class="btn btn-secondary btn-sm" onclick="removeFailure(${index})">Supprimer</button>
                </div>
            `).join('');
        }

        function loadConnectionsPreview(user) {
            const container = document.getElementById('connections-preview');
            const connections = user.connections.slice(0, 6).map(connectionId => {
                const connectionUser = window.LinkedOutAuth.getUserById(connectionId);
                if (!connectionUser) return null;
                
                const initials = window.LinkedOutUtils.StringUtils.getInitials(connectionUser.name);
                return `
                    <div class="connection-preview-item">
                        <div class="connection-avatar-small">${initials}</div>
                        <div class="connection-info">
                            <div class="connection-name">${connectionUser.name}</div>
                            <div class="connection-title">${connectionUser.title}</div>
                        </div>
                    </div>
                `;
            }).filter(Boolean);
            
            container.innerHTML = connections.join('');
            
            if (connections.length === 0) {
                container.innerHTML = '<p class="no-connections">Aucune connexion encore</p>';
            }
        }

        function loadRecentPosts(user) {
            const container = document.getElementById('user-posts');
            const posts = window.LinkedOutFeed.getUserPosts(user.id).slice(0, 3);
            
            container.innerHTML = posts.map(post => `
                <div class="post-preview">
                    <div class="post-preview-content">${window.LinkedOutUtils.StringUtils.truncate(post.content, 150)}</div>
                    <div class="post-preview-meta">
                        <span>${window.LinkedOutUtils.DateUtils.timeAgo(post.timestamp)}</span>
                        <span>‚ù§Ô∏è ${post.likes || 0}</span>
                        <span>üí¨ ${post.comments || 0}</span>
                    </div>
                </div>
            `).join('');
            
            if (posts.length === 0) {
                container.innerHTML = '<p class="no-posts">Aucun post publi√©</p>';
            }
        }

        // Modal functions
        function editProfile() {
            const user = window.LinkedOutAuth.getCurrentUser();
            document.getElementById('edit-name').value = user.name;
            document.getElementById('edit-title').value = user.title;
            document.getElementById('edit-bio').value = user.bio || '';
            document.getElementById('edit-unemployment-start').value = user.unemploymentStart;
            showModal('edit-profile-modal');
        }

        function addSkill() {
            showModal('add-skill-modal');
        }

        function addFailure() {
            showModal('add-failure-modal');
        }

        function showModal(modalId) {
            document.getElementById(modalId).classList.remove('hidden');
        }

        function closeModal(modalId) {
            document.getElementById(modalId).classList.add('hidden');
        }

        function saveProfile() {
            const form = document.getElementById('edit-profile-form');
            const formData = new FormData(form);
            
            const updates = {
                name: formData.get('name'),
                title: formData.get('title'),
                bio: formData.get('bio'),
                unemploymentStart: formData.get('unemploymentStart')
            };
            
            if (window.LinkedOutAuth.updateCurrentUser(updates)) {
                window.LinkedOutUtils.Notifications.show('Profil mis √† jour !', 'success');
                closeModal('edit-profile-modal');
                loadProfileData(window.LinkedOutAuth.getCurrentUser());
            }
        }

        function saveSkill() {
            const skillName = document.getElementById('skill-name').value.trim();
            const user = window.LinkedOutAuth.getCurrentUser();
            
            if (window.LinkedOutEndorsements.addSkill(user.id, skillName)) {
                closeModal('add-skill-modal');
                document.getElementById('skill-name').value = '';
                loadSkills(window.LinkedOutAuth.getCurrentUser());
            }
        }

        function saveFailure() {
            const failureDescription = document.getElementById('failure-description').value.trim();
            const user = window.LinkedOutAuth.getCurrentUser();
            
            if (!failureDescription) {
                window.LinkedOutUtils.Notifications.show('Veuillez d√©crire votre √©chec', 'warning');
                return;
            }
            
            if (!user.failures) user.failures = [];
            user.failures.push(failureDescription);
            
            if (window.LinkedOutAuth.updateCurrentUser(user)) {
                window.LinkedOutUtils.Notifications.show('√âchec ajout√© avec fiert√© !', 'success');
                closeModal('add-failure-modal');
                document.getElementById('failure-description').value = '';
                loadFailures(window.LinkedOutAuth.getCurrentUser());
            }
        }

        function insertSkillSuggestion(skillName) {
            document.getElementById('skill-name').value = skillName;
        }

        function removeSkill(skillName) {
            const user = window.LinkedOutAuth.getCurrentUser();
            if (window.LinkedOutEndorsements.removeSkill(user.id, skillName)) {
                loadSkills(window.LinkedOutAuth.getCurrentUser());
            }
        }

        function removeFailure(index) {
            const user = window.LinkedOutAuth.getCurrentUser();
            if (user.failures && user.failures[index]) {
                user.failures.splice(index, 1);
                if (window.LinkedOutAuth.updateCurrentUser(user)) {
                    window.LinkedOutUtils.Notifications.show('√âchec supprim√©', 'success');
                    loadFailures(window.LinkedOutAuth.getCurrentUser());
                }
            }
        }

        function loadProfileStats(user) {
            const container = document.getElementById('profile-stats');
            const totalEndorsements = user.skills.reduce((sum, skill) => sum + skill.endorsements, 0);
            const earnedBadges = user.badges.filter(badge => badge.earned).length;
            const posts = window.LinkedOutFeed.getUserPosts(user.id);
            
            container.innerHTML = `
                <div class="stat-item">
                    <span class="stat-number">${user.connections.length}</span>
                    <span class="stat-label">Connexions</span>
                </div>
                <div class="stat-item">
                    <span class="stat-number">${totalEndorsements}</span>
                    <span class="stat-label">Endorsements</span>
                </div>
                <div class="stat-item">
                    <span class="stat-number">${earnedBadges}</span>
                    <span class="stat-label">Badges</span>
                </div>
                <div class="stat-item">
                    <span class="stat-number">${posts.length}</span>
                    <span class="stat-label">Posts</span>
                </div>
            `;
        }

        function loadRecentActivity(user) {
            const container = document.getElementById('recent-activity');
            // Mock recent activity
            container.innerHTML = `
                <div class="activity-item">
                    <span class="activity-icon">üèÜ</span>
                    <span class="activity-text">Badge "Ma√Ætre Netflix" obtenu</span>
                    <span class="activity-time">il y a 2j</span>
                </div>
                <div class="activity-item">
                    <span class="activity-icon">üëç</span>
                    <span class="activity-text">5 nouveaux endorsements</span>
                    <span class="activity-time">il y a 3j</span>
                </div>
                <div class="activity-item">
                    <span class="activity-icon">üìù</span>
                    <span class="activity-text">Post publi√©</span>
                    <span class="activity-time">il y a 1 sem</span>
                </div>
            `;
        }

        function showAllBadges() {
            // This would open a modal with all badges
            window.LinkedOutUtils.Notifications.show('Fonctionnalit√© bient√¥t disponible !', 'warning');
        }
    </script>
</body>
</html>